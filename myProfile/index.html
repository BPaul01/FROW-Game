<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="MyProfilePage.css" />
    <script type="text/javascript" src="/auth.js"></script>
    <title>Profilul meu</title>
</head>

<body>
<header class="header">
    <div class="game-title">
        <span class="red-text">F</span>
        <span class="green-text">R</span>
        <span class="orange-text">O</span>
        <span class="yellow-text">W</span>
        <sub class="orange-text">game</sub>
    </div>

    <div class="buttons">
        <button class="simple-button profile" onclick="goBackMyProfile(event)">
            Profilul meu
        </button>
        <button class="simple-button ranking" onclick="goToClasament(event)">
            Clasament
        </button>
        <a class="button start-game" href="/chooseDifficulty/index.html"
        >Începe joc</a
        >
    </div>
</header>

<main>
    <div class="main-section">
        <div class="user">
            <img
                    class="avatar-picture"
                    src="orange-512.webp"
                    alt="Avatar picture"
            />
            <p class="username" id="user"></p>
        </div>

        <div class="scores">
            <p class="score-title">Scorurile mele</p>
        </div>

        <hr class="bold-line" />
        <div id="records"></div>

        <button class="button sign-out" onclick="logOutUser()">
            Deloghează-te
        </button>
    </div>
</main>
</body>
<script>
    const token = localStorage.getItem("token");

    function printAllGamesForCurrentUser() {
        let records = [];

        fetch("/myGames", {
            method: "GET",
            headers: new Headers({ Authentication: `Bearer ${token}` }),
        })
            .then((response) => {
                return response.json();
            })
            .then((data) => {
                console.log(data);
                data.forEach((value, index) => {
                    records += `<div class="record">
              <span class="crt-nr">${index + 1}.</span>
              <span class="points">${value.score}p</span>
              <span class="date">${value.data}</span>
              </div>

              <hr class="line" />`;
                });

                document.getElementById("records").innerHTML = records;
            });
    }

    function setUsername() {
        fetch("/username", {
            method: "GET",
            headers: new Headers({ Authentication: `Bearer ${token}` }),
        })
            .then((response) => {
                return response.text();
            })
            .then((data) => {
                document.getElementById("user").innerHTML = data;
            });
    }
    function goBackMyProfile(event) {
        event.preventDefault();
        location.assign("/myProfile/index.html");
    }
    function goToClasament(event) {
        event.preventDefault();
        location.assign("/RankingsPage/index.html");
    }
    function logOutUser() {
        localStorage.setItem("token", "");
        location.assign("/home/index.html");
    }
    window.onload = function () {
        setUsername();
        printAllGamesForCurrentUser();
    };
</script>
</html>
